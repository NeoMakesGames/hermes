name: Build
on: [push, pull_request]
jobs:
  build:
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v4
      - name: Download and setup Babylon JDK
        run: |
          set -e
          # Download Babylon early-access build (based on JDK 24)
          # Note: Babylon is currently only available as JDK 24 EA builds
          BABYLON_URL="https://download.java.net/java/early_access/babylon/1/openjdk-24-babylon+1-90_linux-x64_bin.tar.gz"
          
          curl -fL -o /tmp/babylon-jdk.tar.gz "$BABYLON_URL"
          mkdir -p "${RUNNER_TEMP}/babylon-jdk"
          tar -xzf /tmp/babylon-jdk.tar.gz -C "${RUNNER_TEMP}/babylon-jdk" --strip-components=1
          echo "${RUNNER_TEMP}/babylon-jdk/bin" >> $GITHUB_PATH
          echo "JAVA_HOME=${RUNNER_TEMP}/babylon-jdk" >> $GITHUB_ENV
      - uses: gradle/actions/wrapper-validation@v4
      - run: ./gradlew build publishToMavenLocal --stacktrace --warning-mode fail
      - uses: actions/upload-artifact@v4
        with:
          name: Artifacts
          path: build/libs/

  client_test:
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Download and setup Babylon JDK
        run: |
          set -e
          # Download Babylon early-access build (based on JDK 24)
          BABYLON_URL="https://download.java.net/java/early_access/babylon/1/openjdk-24-babylon+1-90_linux-x64_bin.tar.gz"
          
          curl -fL -o /tmp/babylon-jdk.tar.gz "$BABYLON_URL"
          mkdir -p "${RUNNER_TEMP}/babylon-jdk"
          tar -xzf /tmp/babylon-jdk.tar.gz -C "${RUNNER_TEMP}/babylon-jdk" --strip-components=1
          echo "${RUNNER_TEMP}/babylon-jdk/bin" >> $GITHUB_PATH
          echo "JAVA_HOME=${RUNNER_TEMP}/babylon-jdk" >> $GITHUB_ENV
      - run: ./gradlew :minecraft:minecraft-test:runProductionAutoTestClient --stacktrace --warning-mode=fail
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: Client Test Screenshots
          path: minecraft/minecraft-test/run/screenshots